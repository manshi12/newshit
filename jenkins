#!/usr/bin/env groovy
@Library(['global-vars@CCRRAID-111_Git_tagIssue', 'pipeline-toolbox@MAVEN-SONAR-DSP','common-vars'])

node('JFROG') {
    stage('Checkout') {
        checkout scm
    }
    
    stage('Build') {
        withMaven(maven: 'Maven-3.6.3', mavenSettingsConfig: 'MAVEN_SETTINGS_XML_JFROG_RIS') {
            sh 'mvn clean package -DskipTests'
        }
    }
    
    stage('Verify Build') {
        sh '''
            echo "Checking target directory:"
            ls -la target/
            echo "JAR files created:"
            find target/ -name "*.jar" -ls
        '''
    }
    
    stage('Integration') {
        cintegrateCommonOnPrem ([
            trigram: 'RIS',
            iappli:'3609',
            mavenSettingsId: 'MAVEN_SETTINGS_XML_JFROG_RIS',
            credentialSonar: 'SONARQUBE_TOKEN_RIS',
            sonarJavaTool: 'openjdk-11',
            sonarMinimumCoverage: 0
        ])
    }
    
    stage('Archive') {
        archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
    }
}
